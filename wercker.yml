box: tsechov/oracle-java7-sbt.0.13.0@0.0.3
build:
    steps:
        - script:
            name: sbt clean compile
            code: |-
                sbt clean compile
        - script:
            name: sbt test
            code: |-
                sbt test
    after-steps:
        - kobim/slack-post:
            subdomain: szamos
            token: $SLACK_WEBHOOK_TOKEN
            channel: shoehorn-build
            username: ${WERCKER_GIT_BRANCH}-build@werckerbot
        - script:
            name: kato
            code: |-
                curl -X POST -d "{\"from\": \"Robot\", \"color\": \"green\", \"renderer\": \"markdown\", \"text\": \"Hello **world**\" }" https://api.kato.im/rooms/c13a90c357893ddb5fc9e07c2291f5c06aa64a617c899c6a4ca5f16ff03ecec2/simple

deploy:
    steps:
        - script:
            name: persist commit-id
            code: |-
                while read a ; do echo ${a//GIT_COMMIT/${WERCKER_GIT_COMMIT}} ; done < $WERCKER_SOURCE_DIR/conf/application.conf > $WERCKER_SOURCE_DIR/conf/application.conf.tmp
                mv $WERCKER_SOURCE_DIR/conf/application.conf.tmp $WERCKER_SOURCE_DIR/conf/application.conf
                cat $WERCKER_SOURCE_DIR/conf/application.conf
        - heroku-deploy:
            key-name: HEROKU_KEYPAIR
    after-steps:
        - kobim/slack-post:
            subdomain: szamos
            token: $SLACK_WEBHOOK_TOKEN
            channel: shoehorn-build
            username: ${WERCKER_GIT_BRANCH}-deploy@werckerbot

        - script:
            name: runscope trigger
            code: |-
                wget -O - "${RUNSCOPE_TRIGGER_URL}?commitId=${WERCKER_GIT_COMMIT}&app=${HEROKU_APP_NAME}"
